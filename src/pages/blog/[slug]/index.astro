---
import { getEntry, render } from "astro:content";
import Head from "@/components/Head.astro";
import BlogLayout from "@/layouts/BlogLayout.astro";
import { Image } from "astro:assets";
import { cn } from "@/lib/utils";
import { Icon } from "astro-icon/components";
import { getCollection } from "astro:content";
import type { GetStaticPaths } from "astro";

export const getStaticPaths = (async () => {
  const projects = await getCollection("blog");
  return projects.map(({ id }) => ({ params: { slug: id } }));
}) satisfies GetStaticPaths;

const { slug } = Astro.params;
const blog = await getEntry("blog", slug);
if (!blog) {
  throw new Error("Could not find blog post 1");
}
const { Content, headings } = await render(blog);
---

<Head title={blog.data.title} />
<BlogLayout headings={headings}>
  <slot slot="details">
    <Image
      src={blog.data.image}
      alt={"Image for " + blog.data.title}
      class={"w-full"}
    />
    <h1 class={cn("text-4xl font-bold mt-10")}>{blog.data.title}</h1>
    <p class={cn("text-lg mt-4")}>{blog.data.description}</p>
    <ol class="flex gap-4 mt-4">
      {
        blog.data.tags.map(async ({ id: tagId }) => {
          const tag = await getEntry("tags", tagId);
          if (!tag) {
            return null;
          }
          return (
            <li class={cn("text-sm text-neutral-500 dark:text-neutral-400")}>
              <Icon
                name={tag.data.icon}
                class={cn("w-4 h-4 inline-block mr-2")}
              />
              {tag.data.text}
            </li>
          );
        })
      }
    </ol>
  </slot>
  <slot slot="content">
    <Content />
  </slot>
</BlogLayout>
